// WIT (WebAssembly Interface Type) definition for MCP security guards
//
// This defines the interface between the AgentGateway host (Rust)
// and the WASM guest module (any language compiled to WASM).

package mcp:security-guard@0.1.0;

/// Guest interface - functions exported by the WASM module
interface guard {
    /// Represents an MCP tool
    record tool {
        name: string,
        description: option<string>,
        input-schema: string,  /// JSON-serialized schema
    }

    /// Context provided by the host
    record guard-context {
        server-name: string,
        identity: option<string>,
        metadata: string,  /// JSON-serialized metadata
    }

    /// Guard decision result
    variant decision {
        allow,
        deny(deny-reason),
        modify(string),  /// JSON-serialized modification
    }

    /// Reason for denying a request
    record deny-reason {
        code: string,
        message: string,
        details: option<string>,  /// JSON-serialized details
    }

    /// Main guard evaluation function
    /// Called by the host for every tools/list response
    evaluate-tools-list: func(tools: list<tool>, context: guard-context) -> result<decision, string>;
}

/// Host interface - functions provided by AgentGateway to the WASM module
interface host {
    /// Log levels: 0=trace, 1=debug, 2=info, 3=warn, 4=error
    log: func(level: u8, message: string);

    /// Get current Unix timestamp in milliseconds
    get-time: func() -> u64;

    /// Get configuration value (returns empty string if not found)
    get-config: func(key: string) -> string;
}

/// The complete world definition
world security-guard {
    export guard;
    import host;
}
