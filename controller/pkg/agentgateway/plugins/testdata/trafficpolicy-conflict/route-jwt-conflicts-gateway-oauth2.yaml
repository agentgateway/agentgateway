apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: test
  namespace: default
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: test-route
  namespace: default
  labels:
    app: chat
spec:
  parentRefs:
  - group: gateway.networking.k8s.io
    kind: Gateway
    name: test
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayPolicy
metadata:
  name: gateway-oauth2
  namespace: default
spec:
  targetRefs:
  - kind: Gateway
    name: test
    group: gateway.networking.k8s.io
  traffic:
    phase: PreRouting
    oauth2:
      authorizationEndpoint: https://issuer.example.com/authorize
      tokenEndpoint: https://issuer.example.com/token
      clientId: agw-client
      clientSecret:
        inline: super-secret
      redirectUri: https://gateway.example.com/oauth2/callback
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayPolicy
metadata:
  name: route-jwt
  namespace: default
spec:
  targetSelectors:
  - kind: HTTPRoute
    group: gateway.networking.k8s.io
    matchLabels:
      app: chat
  traffic:
    jwtAuthentication:
      mode: Strict
      providers:
      - issuer: https://issuer.example.com
        jwks:
          inline: '{"keys":[{"kty":"RSA","kid":"k1","n":"AQAB","e":"AQAB"}]}'

---
# Output
output: null
status:
  ancestors:
  - ancestorRef:
      group: gateway.networking.k8s.io
      kind: Gateway
      name: test
      namespace: default
    conditions:
    - lastTransitionTime: fake
      message: 'invalid auth mode combination: route-target jwtAuthentication conflicts
        with gateway-target oauth2 policy default/gateway-oauth2 on default/test'
      reason: Invalid
      status: "True"
      type: Accepted
    - lastTransitionTime: fake
      message: Policy is not attached due to invalid status
      reason: Pending
      status: "False"
      type: Attached
    controllerName: agentgateway.dev/agentgateway
